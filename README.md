# 基于STM32单片机的智能储物柜控制系统设计

>   智能储物柜结合在线软件对物品进行存取操作，在取件和存件可采用取件码和蓝牙通信取件，采用语音播报辅助取件提醒用户的存放柜门，存储的数据通过SPI写入在外部闪存中，以实现掉电保存和大量数据的存储。可以通过蓝牙串口软件对单片机发送手机号数据，单片机接收到数据返回相应的取件码，若软件发送验证码数据（使用UART串口中断，分状态执行对应操作），匹配成功则单片机响应相关操作。
>
>   
>
>   通信方式涉及GPIO对矩阵键盘的扫描控制，UART对蓝牙的通信，PWM对柜门的控制，SPI对屏幕的通信显示和NOR FLASH的存储控制。





+   上电之后对Flash内部进行扫描，扫描是否有之前存储的数据，并更新变量unavailable（不可用数量），其次对舵机复位
+   主菜单中的使用定时器下方每5秒刷新unavailable与available，便于直观查看可用数量
    
+   蓝牙串口软件 发送格式为：
    +   1、发送手机号接收验证码（Hex格式）
        每两位十进制数字占一个字节，所以手机号一共占6个字节
        +   例如：13 50 23 78 82 40		这里的手机号一共有6个字节，在这个软件中，最后一个十进制为默			认是一个字节中的高4位
            			发送 13 50 23 78 82 40		匹配成功返回 09 03 02 01 00（只是举例，实际上验证码有TIM2的计数值作为随机数的种子，重复的可能极低）
            匹配失败返回 FF FF FF FF FF (验证码是5个字节，返回成功的每一个十进制数占一个字节的低4位)
    +   2、发送验证码驱动舵机（Hex格式） 接收格式为 UTF-8 OR GBK
        		发送验证码有固定的包头格式  包头格式为FF 同样后面也是每个字节一个十进制数（低4位）
        +   例如发送： FF 09 03 02 01 00 	匹配成功返回 “Pickup successful!\r\n”（注意要用UTF-8或GBK的编码格式接收数据，否则会乱码）
